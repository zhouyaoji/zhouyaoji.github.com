<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>mojito_src&#x2F;source&#x2F;lib&#x2F;app&#x2F;addons&#x2F;ac&#x2F;composite.common.js - Mojito API</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.5.0&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.5.0&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="assets&#x2F;img&#x2F;mojito-logo-white-bkg.png" title="Mojito API"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.3.29</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/ActionContext.html">ActionContext</a></li>
            
                <li><a href="..&#x2F;classes/Analytics.common.html">Analytics.common</a></li>
            
                <li><a href="..&#x2F;classes/Assets.common.html">Assets.common</a></li>
            
                <li><a href="..&#x2F;classes/Carrier.common.html">Carrier.common</a></li>
            
                <li><a href="..&#x2F;classes/Composite.common.html">Composite.common</a></li>
            
                <li><a href="..&#x2F;classes/Config.common.html">Config.common</a></li>
            
                <li><a href="..&#x2F;classes/Cookie.client.html">Cookie.client</a></li>
            
                <li><a href="..&#x2F;classes/Cookie.server.html">Cookie.server</a></li>
            
                <li><a href="..&#x2F;classes/Deploy.server.html">Deploy.server</a></li>
            
                <li><a href="..&#x2F;classes/Device.common.html">Device.common</a></li>
            
                <li><a href="..&#x2F;classes/Http.server.html">Http.server</a></li>
            
                <li><a href="..&#x2F;classes/I13n.server.html">I13n.server</a></li>
            
                <li><a href="..&#x2F;classes/Intl.common.html">Intl.common</a></li>
            
                <li><a href="..&#x2F;classes/Meta.common.html">Meta.common</a></li>
            
                <li><a href="..&#x2F;classes/MojitoDispatcher.html">MojitoDispatcher</a></li>
            
                <li><a href="..&#x2F;classes/MojitoServer.html">MojitoServer</a></li>
            
                <li><a href="..&#x2F;classes/MojitProxy.html">MojitProxy</a></li>
            
                <li><a href="..&#x2F;classes/OutputAdapter.common.html">OutputAdapter.common</a></li>
            
                <li><a href="..&#x2F;classes/OutputHandler.html">OutputHandler</a></li>
            
                <li><a href="..&#x2F;classes/Params.common.html">Params.common</a></li>
            
                <li><a href="..&#x2F;classes/Partial.common.html">Partial.common</a></li>
            
                <li><a href="..&#x2F;classes/ResourceStore.server.html">ResourceStore.server</a></li>
            
                <li><a href="..&#x2F;classes/Url.common.html">Url.common</a></li>
            
                <li><a href="..&#x2F;classes/Y.mojito.Client.html">Y.mojito.Client</a></li>
            
                <li><a href="..&#x2F;classes/Y.mojito.lib.MojitoRouter.html">Y.mojito.lib.MojitoRouter</a></li>
            
                <li><a href="..&#x2F;classes/Y.mojito.lib.REST.html">Y.mojito.lib.REST</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="..&#x2F;modules/ActionContext.html">ActionContext</a></li>
            
                <li><a href="..&#x2F;modules/ActionContextAddon.html">ActionContextAddon</a></li>
            
                <li><a href="..&#x2F;modules/CommonLibs.html">CommonLibs</a></li>
            
                <li><a href="..&#x2F;modules/MojitoClient.html">MojitoClient</a></li>
            
                <li><a href="..&#x2F;modules/MojitoServer.html">MojitoServer</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: mojito_src&#x2F;source&#x2F;lib&#x2F;app&#x2F;addons&#x2F;ac&#x2F;composite.common.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x2F;*
 * Copyright (c) 2011-2012, Yahoo! Inc.  All rights reserved.
 * Copyrights licensed under the New BSD License.
 * See the accompanying LICENSE file for terms.
 *&#x2F;


&#x2F;*jslint anon:true, sloppy:true, nomen:true*&#x2F;
&#x2F;*global YUI*&#x2F;


&#x2F;**
 * @module ActionContextAddon
 *&#x2F;
YUI.add(&#x27;mojito-composite-addon&#x27;, function(Y, NAME) {

    function AdapterBuffer(buffer, id, callback) {
        this.buffer = buffer;
        this.id = id;
        this.callback = callback;
        this.__meta = [];
    }


    AdapterBuffer.prototype = {

        done: function(data, meta) {
            this.buffer[this.id].meta = meta;
            this.buffer[this.id].data += data;
            this.buffer.__counter__ -= 1;
            if (this.buffer.__counter__ === 0) {
                &#x2F;&#x2F; TODO: Check why this can be called more than once.
                this.callback();
            }
        },


        flush: function(data, meta) {
            this.buffer[this.id].meta = meta;
            this.buffer[this.id].data += data;
        },


        error: function(err) {
            Y.log(&quot;Error executing child mojit at &#x27;&quot; + this.id + &quot;&#x27;:&quot;, &#x27;error&#x27;,
                    NAME);
            if (err.message) {
                Y.log(err.message, &#x27;error&#x27;, NAME);
            } else {
                Y.log(err, &#x27;error&#x27;, NAME);
            }
            if (err.stack) {
                Y.log(err.stack, &#x27;error&#x27;, NAME);
            }
            &#x2F;&#x2F; Pass back some empty data so we don&#x27;t fail the composite
            this.done(&#x27;&#x27;);
        }
    };


    &#x2F;**
    * &lt;strong&gt;Access point:&lt;&#x2F;strong&gt; &lt;em&gt;ac.composite.*&lt;&#x2F;em&gt;
    * Provides methods for working with many Mojits.
    * @class Composite.common
    *&#x2F;
    function Addon(command, adapter, ac) {
        this.command = command;
        this.dispatch = ac._dispatch;
        this.ac = ac;
        this.adapter = adapter;
    }


    Addon.prototype = {

        namespace: &#x27;composite&#x27;,

        &#x2F;**
         * Automatically dispatches all the children of this mojit and collects
         * their executed values into the view template, keyed by the child&#x27;s
         * name within the mojit&#x27;s configuration. For example, given the mojit
         * spec:
         *
         *
&lt;pre&gt;
&quot;specs&quot;: {
    &quot;parent&quot;: {
        &quot;type&quot;: &quot;MyCompositeMojit&quot;,
         &quot;config&quot;: {
             &quot;children&quot;: {
                 &quot;foo&quot;: {
                     &quot;type&quot;: &quot;FooMojit&quot;
                 },
                 &quot;bar&quot;: {
                     &quot;type&quot;: &quot;BarMojit&quot;
                 }
             }
         }
    }
        }
&lt;&#x2F;pre&gt;
         * And given the view template:
&lt;pre&gt;
&amp;lt;div id=&amp;quot;{{mojit_view_id}}&amp;quot;&amp;gt;
&amp;lt;h1&amp;gt;{{title}}&amp;lt;&#x2F;h1&amp;gt;
&amp;lt;div class=&amp;quot;fooslot&amp;quot;&amp;gt;
    {{{foo}}}
&amp;lt;&#x2F;div&amp;gt;
&amp;lt;div class=&amp;quot;barslot&amp;quot;&amp;gt;
    {{{bar}}}
&amp;lt;&#x2F;div&amp;gt;
&amp;lt;&#x2F;div&amp;gt;
&lt;&#x2F;pre&gt;
         * And the controller:
&lt;pre&gt;
Y.mojito.controller = {
    index: function(ac) {
        ac.composite.done({
            template: { title: &#x27;Hello there&#x27; } &#x2F;&#x2F; for the view only
        });
    }
        };
&lt;&#x2F;pre&gt;
         * This will execute the child intances of the &quot;FooMojit&quot; and
         * &quot;BarMojit&quot;, returning their rendered values into the parent&#x27;s view
         * template, thus rendering the full parent view including the children.
         * All the parent parameters are passed along to children.
         * @method done
         * @param {object} opts The configuration object to be used.
         *     &lt;em&gt;template&lt;em&gt; can be used to provide additional
         * view template values.
         *&#x2F;
        done: function(opts) {
            var template,
                ac = this.ac,
                cfg = this.command.instance.config,
                children = cfg.children;

            opts = opts || {};

            template = opts.template || {};

            if (!children || Y.Object.size(children) === 0) {
                throw new Error(&#x27;Cannot run composite mojit children because&#x27; +
                                &#x27; there are no children defined in the&#x27; +
                                &#x27; composite mojit spec.&#x27;);
            }

            this.execute(cfg, function(data, meta) {
                var merged = Y.merge(template, data);
                ac.done(merged, meta);

            }, this);
        },


        &#x2F;**
         * This method requires an explicit config object and returns
         * a RMP compliant object via a callback.
         *
&lt;pre&gt;
cfg = {
    children: {
        slot-1: {
            type: &quot;default&quot;,
            action: &quot;index&quot;
        },
        slot-2: {
            type: &quot;default&quot;,
            action: &quot;index&quot;,
            params: {
                route: {},
                url: {},
                body: {},
                file: {}
            }
        }
    },
    assets: {}
        }
&lt;&#x2F;pre&gt;
         *
         * The &quot;callback&quot; is an object containg the child slots with its
         * rendered data.
         *
&lt;pre&gt;
callback({
    slot-1: &lt;string&gt;,
    slot-2: &lt;string&gt;
        },
        {
   http: {}
   assets: {}
        })
&lt;&#x2F;pre&gt;
         * @method execute
         * @param {object} cfg The configuration object to be used.
         * @param {function} cb The callback that will be called.
         *&#x2F;
        execute: function(cfg, cb) {

            var ac = this.ac,
                buffer = {},
                content = {},
                meta = {};

            cfg.children = cfg.children || {};

            &#x2F;&#x2F; check to ensure children is an Object, not an array
            if (Y.Lang.isArray(cfg.children)) {
                throw new Error(&#x27;Cannot process children in the format of an&#x27; +
                                &#x27; array. \&#x27;children\&#x27; must be an object.&#x27;);
            }

            &#x2F;&#x2F; check to ensure children doesn&#x27;t have a null child
            &#x2F;&#x2F; in which case it will be automatically discarded to
            &#x2F;&#x2F; facilitate disabling childs based on the context.
            Y.Object.each(cfg.children, function(child, name) {
                if (!child) {
                    delete cfg.children[name];
                }
            });

            meta.children = cfg.children;

            buffer.__counter__ = Y.Object.size(cfg.children);

            this._dispatchChildren(cfg.children, this.command, buffer,
                function() {
                    var name;
                    &#x2F;&#x2F; Reference the data we want from the &quot;buffer&quot; into our
                    &#x2F;&#x2F; &quot;content&quot; obj Also merge the meta we collected.
                    for (name in buffer) {
                        if (buffer.hasOwnProperty(name) &amp;&amp;
                                name !== &#x27;__counter__&#x27;) {
                            content[name] = buffer[name].data || &#x27;&#x27;;

                            if (buffer[name].meta) {
                                meta = Y.mojito.util.metaMerge(meta,
                                        buffer[name].meta);
                            }
                        }
                    }

                    &#x2F;&#x2F; Mix in the assets given via the config
                    if (cfg.assets) {
                        if (!meta.assets) {
                            meta.assets = {};
                        }
                        ac.assets.mixAssets(meta.assets, cfg.assets);
                    }

                    cb(content, meta);
                });
        },


        _dispatchChildren: function(children, command, buffer, callback) {
            &#x2F;&#x2F;Y.log(&#x27;_dispatchChildren()&#x27;, &#x27;debug&#x27;, NAME);

            var childName,
                child,
                childAdapter,
                newCommand;

            &#x2F;&#x2F; Process deferred children before dispatching
            Y.Object.each(children, function(child, name) {
                &#x2F;&#x2F; first off, check to see if this child&#x27;s execution should be
                &#x2F;&#x2F; deferred
                if (child.defer) {
                    &#x2F;&#x2F; it doesn&#x27;t make sense to have a deferred child with a
                    &#x2F;&#x2F; proxy, because the defer means to proxy it
                    &#x2F;&#x2F; through the LazyLoad mojit
                    if (Y.Lang.isObject(child.proxy)) {
                        throw new Error(&#x27;Cannot specify a child mojit spec&#x27; +
                                        &#x27; with both \&#x27;defer\&#x27; and \&#x27;proxy\&#x27;&#x27; +
                                        &#x27; configurations, because \&#x27;defer\&#x27;&#x27; +
                                        &#x27; assumes a \&#x27;proxy\&#x27; to the LazyLoad&#x27; +
                                        &#x27; mojit.&#x27;);
                    }
                    &#x2F;&#x2F; aha! that means we will give it a proxy to the LazyLoad
                    &#x2F;&#x2F; mojit, which will handle lazy execution on the client.
                    child.proxy = {
                        type: &#x27;LazyLoad&#x27;
                    };
                }
                if (Y.Lang.isObject(child.proxy)) {
                    &#x2F;&#x2F; found a proxy, replace the child with the proxy and shove
                    &#x2F;&#x2F; the child to proxy into it
                    children[name] = child.proxy;
                    delete child.proxy;
                    if (!children[name].config) {
                        children[name].config = {};
                    }
                    &#x2F;&#x2F; remove any defer or proxy flags so it doesn&#x27;t reload
                    &#x2F;&#x2F; infinitely
                    child.proxy = undefined;
                    child.defer = false;
                    children[name].config.proxied = child;
                }
            });

            for (childName in children) {
                if (children.hasOwnProperty(childName)) {
                    child = children[childName];
                    &#x2F;&#x2F; Create a buffer for the child
                    buffer[childName] = {name: childName, data: &#x27;&#x27;, meta: {}};

                    &#x2F;&#x2F; Make a new &quot;command&quot; that works in the context of this
                    &#x2F;&#x2F; composite
                    newCommand = {
                        instance: child,
                        &#x2F;&#x2F; use action in child spec or default to index
                        action: child.action || &#x27;index&#x27;,
                        context: command.context,
                        params: child.params || command.params
                    };

                    childAdapter = new AdapterBuffer(buffer, childName,
                            callback);
                    childAdapter = Y.mix(childAdapter, this.adapter);

                    this.dispatch(newCommand, childAdapter);
                }
            }
        }
    };

    Y.namespace(&#x27;mojito.addons.ac&#x27;).composite = Addon;

}, &#x27;0.1.0&#x27;, {requires: [
    &#x27;mojito-util&#x27;,
    &#x27;mojito-params-addon&#x27;
]});

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
