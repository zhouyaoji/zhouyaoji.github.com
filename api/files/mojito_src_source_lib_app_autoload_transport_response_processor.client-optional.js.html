<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>mojito_src&#x2F;source&#x2F;lib&#x2F;app&#x2F;autoload&#x2F;transport&#x2F;response_processor.client-optional.js - Mojito API</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.5.0&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.5.0&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="assets&#x2F;img&#x2F;mojito-logo-white-bkg.png" title="Mojito API"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.3.29</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/ActionContext.html">ActionContext</a></li>
            
                <li><a href="..&#x2F;classes/Analytics.common.html">Analytics.common</a></li>
            
                <li><a href="..&#x2F;classes/Assets.common.html">Assets.common</a></li>
            
                <li><a href="..&#x2F;classes/Carrier.common.html">Carrier.common</a></li>
            
                <li><a href="..&#x2F;classes/Composite.common.html">Composite.common</a></li>
            
                <li><a href="..&#x2F;classes/Config.common.html">Config.common</a></li>
            
                <li><a href="..&#x2F;classes/Cookie.client.html">Cookie.client</a></li>
            
                <li><a href="..&#x2F;classes/Cookie.server.html">Cookie.server</a></li>
            
                <li><a href="..&#x2F;classes/Deploy.server.html">Deploy.server</a></li>
            
                <li><a href="..&#x2F;classes/Device.common.html">Device.common</a></li>
            
                <li><a href="..&#x2F;classes/Http.server.html">Http.server</a></li>
            
                <li><a href="..&#x2F;classes/I13n.server.html">I13n.server</a></li>
            
                <li><a href="..&#x2F;classes/Intl.common.html">Intl.common</a></li>
            
                <li><a href="..&#x2F;classes/Meta.common.html">Meta.common</a></li>
            
                <li><a href="..&#x2F;classes/MojitoDispatcher.html">MojitoDispatcher</a></li>
            
                <li><a href="..&#x2F;classes/MojitoServer.html">MojitoServer</a></li>
            
                <li><a href="..&#x2F;classes/MojitProxy.html">MojitProxy</a></li>
            
                <li><a href="..&#x2F;classes/OutputAdapter.common.html">OutputAdapter.common</a></li>
            
                <li><a href="..&#x2F;classes/OutputHandler.html">OutputHandler</a></li>
            
                <li><a href="..&#x2F;classes/Params.common.html">Params.common</a></li>
            
                <li><a href="..&#x2F;classes/Partial.common.html">Partial.common</a></li>
            
                <li><a href="..&#x2F;classes/ResourceStore.server.html">ResourceStore.server</a></li>
            
                <li><a href="..&#x2F;classes/Url.common.html">Url.common</a></li>
            
                <li><a href="..&#x2F;classes/Y.mojito.Client.html">Y.mojito.Client</a></li>
            
                <li><a href="..&#x2F;classes/Y.mojito.lib.MojitoRouter.html">Y.mojito.lib.MojitoRouter</a></li>
            
                <li><a href="..&#x2F;classes/Y.mojito.lib.REST.html">Y.mojito.lib.REST</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="..&#x2F;modules/ActionContext.html">ActionContext</a></li>
            
                <li><a href="..&#x2F;modules/ActionContextAddon.html">ActionContextAddon</a></li>
            
                <li><a href="..&#x2F;modules/CommonLibs.html">CommonLibs</a></li>
            
                <li><a href="..&#x2F;modules/MojitoClient.html">MojitoClient</a></li>
            
                <li><a href="..&#x2F;modules/MojitoServer.html">MojitoServer</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: mojito_src&#x2F;source&#x2F;lib&#x2F;app&#x2F;autoload&#x2F;transport&#x2F;response_processor.client-optional.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x2F;*
 * Copyright (c) 2011-2012, Yahoo! Inc.  All rights reserved.
 * Copyrights licensed under the New BSD License.
 * See the accompanying LICENSE file for terms.
 *&#x2F;


&#x2F;*jslint anon:true, sloppy:true, nomen:true*&#x2F;
&#x2F;*global YUI*&#x2F;


YUI.add(&#x27;response-processor&#x27;, function(Y) {

    var NAME = &#x27;responseProcessor&#x27;,
        OK = &#x27;ok&#x27;,
        Lang = Y.Lang,
        isUndefined = Lang.isUndefined,
        ERROR = &#x27;error&#x27;,

        &#x2F;&#x2F;error types
        E_BROWSER = &#x27;browser&#x27;,
        E_CRUMB = &#x27;crumb&#x27;,
        &#x2F;&#x2F;result detail types
        E_RESULT_NOCOOKIES = &#x27;nocookies&#x27;,
        E_RESULT_BADCRUMB = &#x27;badcrumb&#x27;,

        &#x2F;&#x2F; beans
        _responseFormatter,
        _errorReporter,
        _configProvider,
        ResponseProcessor;


    &#x2F;**
     * creates a mimic of the yui response object
     * for use in web service calls
     * @param {DaliResponseWs} response the response from the daliProxy.
     * @return {Object} formated response object.
     * @private
     *&#x2F;
    function _createWebServiceResponseObject(response) {

        &#x2F;&#x2F; Y.log(&#x27;Building web service response object&#x27;, &#x27;info&#x27;, NAME);

        var myData = Y.Object(response.data),
            headerHash = false, &#x2F;&#x2F; cache the header lookup for later after
                                &#x2F;&#x2F; first time
            respHeaderFlag = false; &#x2F;&#x2F;save string replace until needed


        myData.getResponseHeader = function(header) {
            var headerList,
                len,
                i,
                tmparr;

            &#x2F;&#x2F; don&#x27;t bother processing this unless someone wants it.
            if (!headerHash) {
                &#x2F;&#x2F; to comply with yui io docs.
                this.responseHeader =
                    myData.responseHeader.replace(&#x27;\r\n&#x27;, &#x27;\n&#x27;);
                respHeaderFlag = true;
                headerList = myData.responseHeader.split(&#x27;\n&#x27;);
                len = headerList.length;
                headerHash = {};
                for (i = 0; i &lt; len; i += 1) {
                    tmparr = headerList[i].split(&#x27;: &#x27;);
                    headerHash[tmparr[0]] = tmparr[1];
                }
            }

            return headerHash[header];
        };


        myData.getAllResponseHeaders = function() {
            if (!respHeaderFlag) {
                &#x2F;&#x2F; to comply with yui io docs.
                this.responseHeader =
                    myData.responseHeader.replace(&#x27;\r\n&#x27;, &#x27;\n&#x27;);
            }
            return this.responseHeader;
        };

        return Y.mix(response, myData);
    }


    ResponseProcessor = function() {
        var inst = {

            setConfigProvider: function(provider) {
                _configProvider = provider;
            },


            setRespFormatter: function(formatter) {
                _responseFormatter = formatter;
            },


            setErrorReporter: function(reporter) {
                _errorReporter = reporter;
            },


            replaceResponseFormatter: function(formatter) {
                _responseFormatter.replaceResponseFormatter(formatter);
            },


            processResponse: function(o, metaData, badcookie) {
                var txId = o.txId,
                    fail = true,
                    response,
                    result,
                    resultDetail,
                    errorType,
                    message;

                if (isUndefined(metaData)) {
                    &#x2F;&#x2F; this will happen if the request was aborted before it was
                    &#x2F;&#x2F; sent
                    return;
                }

                response = {
                    data: o.data
                };

                response.cb = metaData.cb;
                &#x2F;&#x2F; TODO: replace with a &quot;wasSuccessful()&quot; call. Need to support
                &#x2F;&#x2F; 304 etc.
                if (o.status === 200 || o.status === 201) {
                    response.status = OK;
                    response.result = OK;
                    result = OK;
                    fail = false;
                } else {
                    response.status = ERROR;
                    response.result = ERROR;
                    if (o.status === 400) {
                        errorType = E_CRUMB;
                        message = &#x27;Invalid crumb.&#x27;;
                        resultDetail = E_RESULT_BADCRUMB;
                        result = ERROR;

                        if (!window.navigator.cookieEnabled ||
                                badcookie === &#x27;badcookie&#x27;) {
                            errorType = E_BROWSER;
                            resultDetail = E_RESULT_NOCOOKIES;
                            message = &#x27;Cookies are disabled&#x27;;
                        }

                        _errorReporter.error(errorType, message);
                    }
                }

                this.fire(&#x27;responseProcessed&#x27;, {
                    type: &#x27;responseProcessed&#x27;,
                    txId: txId,
                    response: response,
                    method: (fail ? &#x27;failure&#x27; : &#x27;success&#x27;),
                    result: result,
                    resultDetail: resultDetail
                }, NAME);
            },


            createResponseObject: function(response, platform) {
                &#x2F;&#x2F; Y.log(&#x27;Building response object&#x27;, &#x27;debug&#x27;, NAME);

                if (response.data &amp;&amp; response.data.responseText) {
                    &#x2F;&#x2F; this will only happen for webservice responses...sure...
                    &#x2F;&#x2F; Y.log(&#x27;This looks like a proxied web service request,&#x27; +
                    &#x2F;&#x2F;     &#x27; passing to WS formatter&#x27;, &#x27;debug&#x27;, NAME);
                    return _createWebServiceResponseObject(response);
                } else {
                    &#x2F;&#x2F; support a wrong implementation in old daliTransport
                    &#x2F;&#x2F; porting the mistake forward.
                    if (response.data) {
                        if (response.data.mods) {
                            &#x2F;&#x2F; this is for backwards compatibility
                            response.mods = response.data.mods;
                            &#x2F;&#x2F; this is the correct format
                            response.mod = response.mods[0];
                            delete response.data.mods;
                        }

                        if (response.data.html) {
                            response.html = response.data.html;
                            delete response.data.html;
                        }

                        if (response.data.res) {
                            response.res = response.data.res;
                            delete response.data.res;
                        }
                    }

                    response = _responseFormatter.formatResponse(response);
                    &#x2F;&#x2F; no op.
                    return response;
                }
            }
        };
        return new Y.Dali.Bean(inst);
    };

    ResponseProcessor.NAME = NAME;

    Y.Dali.beanRegistry.registerBean(NAME, ResponseProcessor);

}, &#x27;1.6.3&#x27;, {requires: [
    &#x27;dali-bean&#x27;,
    &#x27;breg&#x27;
]});

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
