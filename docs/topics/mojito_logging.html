

<!DOCTYPE html>
<html lang="en">
<head>
    <title>Logging - Mojito Topics</title>
    <link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/combo?3.5.0/build/cssgrids/cssgrids-min.css&amp;3.5.0/build/cssreset/cssreset-min.css&amp;3.5.0/build/cssfonts/cssfonts-min.css&amp;3.5.0/build/cssbutton/cssbutton-min.css">
	<link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/combo?2.9.0/build/treeview/assets/skins/sam/treeview.css"> 
    <link rel="stylesheet" type="text/css" href="_static/pipes.css">
</head>
<body class="yui-skin-sam yui3-skin-sam seoui seoui-fixed">
	<div id="seoui-container">
	    <header>
  <div id="doc">
        <div id="hd">
            <div id="login">You're logged in as <a href="https://edit.yahoo.com/config/eval_profile?.done=http%3A%2F%2Fpipes.yahoo.com&.intl=us&.pd=c%3DdTYCKFOp2e5m7Y4v1lJ1mBU-&.src=pipes">zhouyaoji</a> (<a href="https://login.yahoo.com/config/login?.done=http%3A%2F%2Fpipes.yahoo.com&.intl=us&.pd=c%3DdTYCKFOp2e5m7Y4v1lJ1mBU-&.src=pipes&logout=1">logout</a>)</div>
            <a class="logo" href="."><img src="http://l.yimg.com/a/i/us/pps/pipeslogo_whitebg.gif" width="119" height="45" alt="Pipes" title="Pipes"/></a>
            <div class="nav">
                <ul id="topnav">
                    <li><a class="navlink" href="http://pipes.yahoo.com/">Home</a></li>
                    <li><a class="navlink" href="http://pipes.yahoo.com/pipes/person.info">My Pipes</a></li>
                    <li><a class="navlink" href="http://pipes.yahoo.com/pipes/pipes.popular">Browse</a></li>
                    <li><a class="navlink" href="http://discuss.pipes.yahoo.com/">Discuss</a></li>
                    <li><a class="navlink" href="../docs">Documentation</a></li>
                    <li class="newpipeli"><a class="navlink newpipe" href="http://pipes.yahoo.com/pipes/pipe.edit">Create a pipe</a></li>
                </ul>
                <form id="searchbox" action="http://pipes.yahoo.com/pipes/search" method="get">
                     <input type="text" name="q" value="">
                     <input type="image" class="searchimg" src="http://l.yimg.com/a/i/spacer.gif" width="20" height="19" alt="submit">
                </form>
            </div>
        </div>

    	</header>
    	<div id="seoui-application-content">
            <div class="yui3-g">
                <div class="yui3-u-2-1">
                    
                    <div class="section" id="logging">
<h1>Logging<a class="headerlink" href="#logging" title="Permalink to this headline">¶</a></h1>
<p>Mojito has its own logging system. When you call <tt class="docutils literal"><span class="pre">Y.log</span></tt> from within your mojits, your log messages are intercepted and processed by Mojito. This allows you
to create your own log formatting, writing, and publishing functions for both your client and server runtimes. It also allows you to enable log buffering,
so performance during crucial runtime periods is not adversely affected.</p>
<div class="section" id="log-levels">
<h2>Log Levels<a class="headerlink" href="#log-levels" title="Permalink to this headline">¶</a></h2>
<p>Mojito has the following five log levels:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">DEBUG</span></tt></li>
<li><tt class="docutils literal"><span class="pre">INFO</span></tt></li>
<li><tt class="docutils literal"><span class="pre">WARN</span></tt></li>
<li><tt class="docutils literal"><span class="pre">ERROR</span></tt></li>
<li><tt class="docutils literal"><span class="pre">MOJITO</span></tt></li>
</ul>
<p>All of them should be familiar except the last, which are framework-level messages that indicate that an important framework event is occurring (one that users might want to track).</p>
<p>Setting a log level of <tt class="docutils literal"><span class="pre">WARN</span></tt> will filter out all <tt class="docutils literal"><span class="pre">DEBUG</span></tt> and <tt class="docutils literal"><span class="pre">INFO</span></tt> messages, while <tt class="docutils literal"><span class="pre">WARN</span></tt>, <tt class="docutils literal"><span class="pre">ERROR</span></tt>, and <tt class="docutils literal"><span class="pre">MOJITO</span></tt> log messages will be processed. To see all
log messages, set the log level to <tt class="docutils literal"><span class="pre">DEBUG</span></tt>.</p>
</div>
<div class="section" id="yui-library-logs">
<h2>YUI Library Logs<a class="headerlink" href="#yui-library-logs" title="Permalink to this headline">¶</a></h2>
<p>By default, all log messages generated by the YUI library itself are processed. The log level filter is also applied to these messages, but within the Mojito log output,
a &#8220;YUI-&#8221; identifier is added to them. So when YUI emits a <tt class="docutils literal"><span class="pre">WARN</span></tt> level log message, the Mojito logs will display a <tt class="docutils literal"><span class="pre">YUI-WARN</span></tt> log level. This helps differentiate between
application messages and YUI framework messages.</p>
<p>YUI logs can be turned on and off for both server and client within an application&#8217;s log configuration (see below).</p>
</div>
<div class="section" id="log-defaults">
<h2>Log Defaults<a class="headerlink" href="#log-defaults" title="Permalink to this headline">¶</a></h2>
<p>The server and client log settings have the following default values:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">level:</span></tt> <tt class="docutils literal"><span class="pre">DEBUG</span></tt> - log level filter.</li>
<li><tt class="docutils literal"><span class="pre">yui:</span></tt> <tt class="docutils literal"><span class="pre">true</span></tt> - determines whether YUI library logs are displayed.</li>
<li><tt class="docutils literal"><span class="pre">buffer:</span></tt> <tt class="docutils literal"><span class="pre">false</span></tt> -  determines whether logs are buffered.</li>
<li><tt class="docutils literal"><span class="pre">maxBufferSize:</span> <span class="pre">1024</span></tt> - the number of logs the buffer holds before auto-flushing.</li>
<li><tt class="docutils literal"><span class="pre">timestamp:</span> <span class="pre">true</span></tt> -  log statements are given a timestamp if value is true.</li>
<li><tt class="docutils literal"><span class="pre">defaultLevel:</span> <span class="pre">'info'</span></tt> - if <tt class="docutils literal"><span class="pre">Y.log</span></tt> is called without a log level, this is the default.</li>
</ul>
</div>
<div class="section" id="log-configuration">
<h2>Log Configuration<a class="headerlink" href="#log-configuration" title="Permalink to this headline">¶</a></h2>
<p>All the values above are configurable through the <a class="reference external" href="../intro/mojito_configuring.html#log-object">log object</a> in the <tt class="docutils literal"><span class="pre">application.json</span></tt> file. In the example <tt class="docutils literal"><span class="pre">application.json</span></tt>
below, the <tt class="docutils literal"><span class="pre">log</span></tt> object has both <tt class="docutils literal"><span class="pre">client</span></tt> and <tt class="docutils literal"><span class="pre">server</span></tt> objects that override the defaults for <tt class="docutils literal"><span class="pre">level</span></tt> and <tt class="docutils literal"><span class="pre">yui</span></tt>.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">[</span>
  <span class="p">{</span>
    <span class="s2">&quot;settings&quot;</span><span class="o">:</span> <span class="p">[</span> <span class="s2">&quot;master&quot;</span> <span class="p">],</span>
    <span class="s2">&quot;log&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;client&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;level&quot;</span><span class="o">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
        <span class="s2">&quot;yui&quot;</span><span class="o">:</span> <span class="kc">false</span>
      <span class="p">},</span>
      <span class="s2">&quot;server&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;level&quot;</span><span class="o">:</span> <span class="s2">&quot;info&quot;</span><span class="p">,</span>
        <span class="s2">&quot;yui&quot;</span><span class="o">:</span> <span class="kc">false</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">...</span>
  <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="mutator-log-functions">
<h2>Mutator Log Functions<a class="headerlink" href="#mutator-log-functions" title="Permalink to this headline">¶</a></h2>
<p>You can create different write function to change the format of log messages and control where the logs are written. The logger has functions for formatting, writing,
and publishing log messages that can be provided by a Mojito application. The function names are defined by users. For example, you could name the log formatter
either <tt class="docutils literal"><span class="pre">formatLogs</span></tt> or <tt class="docutils literal"><span class="pre">log_formatter</span></tt>.</p>
<div class="section" id="custom-log-formatter">
<h3>Custom Log Formatter<a class="headerlink" href="#custom-log-formatter" title="Permalink to this headline">¶</a></h3>
<p>The log formatter function accepts the log message, the log level, a string identifying the source of the log (usually the YUI module name emitting the log), a timestamp,
and the complete <tt class="docutils literal"><span class="pre">logOptions</span></tt> object. The function returns a string, which is passed to the log writer.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">function</span> <span class="p">{</span><span class="nx">log_formatter_name</span><span class="p">}(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">logLevel</span><span class="p">,</span> <span class="nx">source</span><span class="p">,</span> <span class="nx">timestamp</span><span class="p">,</span> <span class="nx">logOptions</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="s2">&quot;formatted message&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="custom-log-writer">
<h3>Custom Log Writer<a class="headerlink" href="#custom-log-writer" title="Permalink to this headline">¶</a></h3>
<p>The log writer function accepts a string and does something with it. You can provide a function that does whatever you want with the log string. The default log writer
calls <tt class="docutils literal"><span class="pre">console.log</span></tt>.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">function</span> <span class="p">{</span><span class="nx">log_writer_name</span><span class="p">}(</span><span class="nx">logMessage</span><span class="p">[</span><span class="nx">s</span><span class="p">])</span> <span class="p">{}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Your log writer function must be able to handle a string or an array of strings. If you have set buffered logging, it may be sent an array of formatted log messages.</p>
</div>
</div>
<div class="section" id="custom-log-publisher">
<h3>Custom Log Publisher<a class="headerlink" href="#custom-log-publisher" title="Permalink to this headline">¶</a></h3>
<p>If a log publisher function is provided, it is expected to format and write logs. Thus, a log publisher function takes the place of the log formatter and the log writer functions
and accepts the same parameters as the log formatter function.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">function</span> <span class="p">{</span><span class="nx">log_publisher_name</span><span class="p">}(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">logLevel</span><span class="p">,</span> <span class="nx">source</span><span class="p">,</span> <span class="nx">timestamp</span><span class="p">,</span> <span class="nx">logOptions</span><span class="p">)</span> <span class="p">{</span>
</pre></div>
</div>
</div>
<div class="section" id="custom-log-functions-on-the-client">
<h3>Custom Log Functions on the Client<a class="headerlink" href="#custom-log-functions-on-the-client" title="Permalink to this headline">¶</a></h3>
<p>To provide custom log function on the client, you add the log function to a JavaScript asset that your application will load.</p>
<p>In the example JavaScript asset below, the log function <tt class="docutils literal"><span class="pre">formatter</span></tt> is first defined and then set as the log formatter function.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">function</span> <span class="nx">formatter</span><span class="p">(</span><span class="nx">msg</span><span class="p">,</span> <span class="nx">lvl</span><span class="p">,</span> <span class="nx">src</span><span class="p">,</span> <span class="nx">ts</span><span class="p">,</span> <span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="s2">&quot;LOG MSG: &quot;</span> <span class="o">+</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; -[&quot;</span> <span class="o">+</span> <span class="nx">lvl</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;]- (&quot;</span> <span class="o">+</span> <span class="nx">ts</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">;</span>
<span class="p">}</span>
<span class="nx">YUI</span><span class="p">.</span><span class="nx">_mojito</span><span class="p">.</span><span class="nx">logger</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;formatter&#39;</span><span class="p">,</span> <span class="nx">formatter</span><span class="p">);</span>
</pre></div>
</div>
<p>Using the <tt class="docutils literal"><span class="pre">formatter</span></tt> function above, the log messages will have the following format:</p>
<p><tt class="docutils literal"><span class="pre">&gt;LOG</span> <span class="pre">MSG:</span> <span class="pre">dispatcher</span> <span class="pre">loaded</span> <span class="pre">and</span> <span class="pre">waiting</span> <span class="pre">to</span> <span class="pre">rock!</span> <span class="pre">-[INFO]-</span> <span class="pre">(1305666208939)</span></tt></p>
</div>
<div class="section" id="custom-log-functions-on-the-server">
<h3>Custom Log Functions on the Server<a class="headerlink" href="#custom-log-functions-on-the-server" title="Permalink to this headline">¶</a></h3>
<p>On the server, you must add log mutator functions to <tt class="docutils literal"><span class="pre">server.js</span></tt>, so that Mojito will set them as the log functions before starting the server.</p>
<p>In this example <tt class="docutils literal"><span class="pre">server.js</span></tt>, <tt class="docutils literal"><span class="pre">writeLog</span></tt> writes logs to the file system.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">mojito</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;mojito&#39;</span><span class="p">),</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">),</span> <span class="nx">logPath</span> <span class="o">=</span> <span class="s2">&quot;/tmp/mojitolog.txt&quot;</span><span class="p">;</span>
<span class="kd">function</span> <span class="nx">writeLog</span><span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">fs</span><span class="p">.</span><span class="nx">writeFile</span><span class="p">(</span><span class="nx">logPath</span><span class="p">,</span> <span class="nx">msg</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// You can access log formatter, writer, or</span>
<span class="c1">// publisher for the server here.</span>
<span class="nx">mojito</span><span class="p">.</span><span class="nx">setLogWriter</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">logMessage</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">writeLog</span><span class="p">(</span><span class="nx">logMessage</span> <span class="o">+</span> <span class="s1">&#39;\n&#39;</span><span class="p">);</span>
<span class="p">});</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">mojito</span><span class="p">.</span><span class="nx">createServer</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="log-buffering">
<h2>Log Buffering<a class="headerlink" href="#log-buffering" title="Permalink to this headline">¶</a></h2>
<p>To avoid performance issues caused by logging, you can enable buffering, which will configure Mojito to cache all logs in memory. You can force Mojito to flush the logs with
the <tt class="docutils literal"><span class="pre">Y.log</span></tt> function or setting the maximum buffer size. The following sections show you how to enable buffering and force Mojito to flush the cached logs.</p>
<div class="section" id="enable-buffering">
<h3>Enable Buffering<a class="headerlink" href="#enable-buffering" title="Permalink to this headline">¶</a></h3>
<p>To configure Mojito to buffer your logs,  set the <tt class="docutils literal"><span class="pre">buffer</span></tt> property to <tt class="docutils literal"><span class="pre">true</span></tt> in the <tt class="docutils literal"><span class="pre">log</span></tt> object as shown in the example <tt class="docutils literal"><span class="pre">application.json</span></tt> below.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">[</span>
  <span class="p">{</span>
    <span class="s2">&quot;settings&quot;</span><span class="o">:</span> <span class="p">[</span> <span class="s2">&quot;master&quot;</span> <span class="p">],</span>
    <span class="s2">&quot;log&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;client&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;buffer&quot;</span><span class="o">:</span> <span class="kc">true</span>
      <span class="p">},</span>
      <span class="s2">&quot;server&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;buffer&quot;</span><span class="o">:</span> <span class="kc">true</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">...</span>
  <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="flush-cached-logs">
<h3>Flush Cached Logs<a class="headerlink" href="#flush-cached-logs" title="Permalink to this headline">¶</a></h3>
<p>Mojito provides you with two ways to forcefully flush cached logs. When you have buffering enabled, you can force Mojito to flush the cached logs with <tt class="docutils literal"><span class="pre">Y.log(({flush:</span> <span class="pre">true})</span></tt>.
You can also set the maximum buffer size, so that Mojito will flush cached logs after the cache has reached the maximum buffer size.</p>
<p>In the example <tt class="docutils literal"><span class="pre">application.json</span></tt> below, the maximum buffer size is set to be 4096 bytes. Once the log cache reaches this size, the logs are then flushed. The default size of
the log cache is 1024 bytes.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">[</span>
  <span class="p">{</span>
    <span class="s2">&quot;settings&quot;</span><span class="o">:</span> <span class="p">[</span> <span class="s2">&quot;master&quot;</span> <span class="p">],</span>
    <span class="s2">&quot;log&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;client&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;buffer&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="s2">&quot;maxBufferSize&quot;</span><span class="o">:</span> <span class="mi">4096</span>
      <span class="p">},</span>
      <span class="s2">&quot;server&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;buffer&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="s2">&quot;maxBufferSize&quot;</span><span class="o">:</span> <span class="mi">4096</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">...</span>
  <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</div>

                </div>
            </div>
            
    	</div>
	</div>
	<footer>
            <div id="ft">
        <span class="copyright">Copyright &copy; 2012 Yahoo! Inc. All rights reserved.</span>
        <ul id="ft-tou">
            <li>
                <a href="http://privacy.yahoo.com/privacy/us/pipes">Your Privacy</a> 
            </li>
            <li>
                <a href="http://info.yahoo.com/legal/us/yahoo/pipes/pipes-4396.html">Terms of Use</a> 
            </li>
            <li>
                <a href="http://docs.yahoo.com/info/copyright/copyright.html">Copyright/IP Policy</a>
            </li>
             <li>
                <a href="<?php echo create_url('docs') ?>">Help</a> 
            </li>
            <li class="last">
                <a href="http://suggestions.yahoo.com/?prop=Pipes">Feedback</a>
            </li>
        </ul>
        <ul id="ft-extra">
            <li><span>Powered by <a href="http://developer.yahoo.com/yql/console/" target="_blank">YQL</a></span></li>
            <li class="last">             
	            <a href="http://www.yahoo.com/">
	                <span class="yahoo-logo-from">from</span>
	                <img src="http://l.yimg.com/g/images/home_yahoo_grey.gif.v3" width="56" height="11" alt="Yahoo! Pipes">
	            </a>        
            </li>
           
        </ul>
    </div><!--/#ft --> 
	</footer>
	<script type="text/javascript" src="http://yui.yahooapis.com/combo?3.4.1/build/yui/yui-min.js"></script>
	<script type="text/javascript" src="/assets/devel-seoui-base.js?v=None"></script>
	<script type="text/javascript" src="/assets/rst/ydn-min.js?v=None"></script>
</body>
</html>